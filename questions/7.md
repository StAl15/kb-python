### Модули и пакеты. Импорт. Объект модуля, система дистрибуции пакетов в Python. Способы импортирования модулей. Относительные и абсолютные импорты. Пакеты. Система поиска и загрузки модулей.

### Модули

Что такое модуль в Python?
Под модулем в Python понимается файл с расширением .py. Модули предназначены для того, чтобы в них хранить часто
используемые функции, классы, константы и т.п. Можно условно разделить модули и программы: программы предназначены для
непосредственного запуска, а модули для импортирования их в другие программы. Стоит заметить, что модули могут быть
написаны не только на языке Python, но и на других языках (например C).

Как импортировать модули в Python?
Самый простой способ импортировать модуль в Python это воспользоваться конструкцией:

_**import имя_модуля**_

Импорт и использование модуля math, который содержит математические функции, будет выглядеть вот так.

```python
>> > import math
>> > math.factorial(5)
120
```

За один раз можно импортировать сразу несколько модулей, для этого их нужно перечислить через запятую после слова
import:

import имя_модуля1, имя_модуля2

```python
>> > import math, datetime
>> > math.cos(math.pi / 4)
0.707106781186547
>> > datetime.date(2017, 3, 21)
datetime.date(2017, 3, 21)
```

Если вы хотите задать псевдоним для модуля в вашей программе, можно воспользоваться вот таким синтаксисом:

import имя_модуля as новое_имя

```python
>> > import math as m
>> > m.sin(m.pi / 3)
0.866025403784438
```

Используя любой из вышеперечисленных подходов, при вызове функции из импортированного модуля, вам всегда придется
указывать имя модуля (или псевдоним). Для того, чтобы этого избежать делайте импорт через конструкцию from … import…

from имя_модуля import имя_объекта

```python
>> > from math import cos
>> > cos(3.14)
0.999998731727539
```

При этом импортируется только конкретный объект (в нашем примере: функция cos), остальные функции недоступны, даже если
при их вызове указать имя модуля.

Для имортирования нескольких функций из модуля, можно перечислить их имена через запятую.

from имя_модуля import имя_объекта1, имя_объекта2

```python
>> > from math import cos, sin, pi
>> > cos(pi / 3)
0.500000000000000
>> > sin(pi / 3)
0.866025403784438
```

Импортируемому объекту можно задать псевдоним.

from имя_модуля import имя_объекта as псевдоним_объекта

```python
>> > from math import factorial as f
>> > f(4)
24
```

Если необходимо импортировать все фукнции, классы и т.п. из модуля, то воспользуйтесь следующей формой оператора from …
import …

from имя_модуля import *

```python
>> > from math import *
>> > cos(pi / 2)
6.123233995736766e-17
>> > sin(pi / 4)
0.707106781186547
>> > factorial(6)
720
```

### Пакеты в Python

#### Что такое пакет в Python?

Пакет в Python – это каталог, включающий в себя другие каталоги и модули, но при этом дополнительно содержащий файл _
_init__.py. Пакеты используются для формирования пространства имен, что позволяет работать с модулями через указание
уровня вложенности (через точку).

Для импортирования пакетов используется тот же синтаксис, что и для работы с модулями.

Использование пакетов в Python
Рассмотрим следующую структуру пакета:

```python
fincalc
| -- __init__.py
| -- simper.py
| -- compper.py
| -- annuity.py
```

Пакет fincal содержит в себе модули для работы с простыми процентами (simper.py), сложными процентами (compper.py) и
аннуитетами (annuity.py).

Для использования фукнции из модуля работы с простыми процентами, можно использовать один из следующих вариантов:

```python
import fincalc.simper

fv = fincalc.simper.fv(pv, i, n)
```

```python
import fincalc.simper as sp

fv = sp.fv(pv, i, n)
```

```python
from fincalc import simper

fv = simper.fv(pv, i, n)
```

Файл __init__.py может быть пустым или может содержать переменную __all__, хранящую список модулей, который
импортируется при загрузке через конструкцию

from имя_пакета import *

Например для нашего случая содержимое __init__.py может быть вот таким:

```python
__all__ = ["simper", "compper", "annuity"]
```

```text
!!! -------- ЗАМЕТКА --------- !!!
Вы можете представить пакеты как каталоги в файловой системе, 
а модули как файлы в каталогах, но не стоит воспринимать эту аналогию слишком буквально,
поскольку пакеты и модули не обязательно должны возникать из файловой системы.
Важно помнить, что все пакеты являются модулями, но не все модули являются пакетами. 
Или, говоря иначе, пакеты - это просто особый вид модулей.
В частности, любой модуль, содержащий атрибут __path__, считается пакетом.

Все модули имеют имя. 
Имена подпакетов отделяются от имени родительского пакета точкой,
подобно стандартному синтаксису доступа к атрибутам в Python.
Таким образом, у вас может быть пакет email, который в свою очередь 
имеет подпакет email.mime и модуль внутри этого подпакета email.mime.text.
```

### Система импорта

Код Python в одном модуле module получает доступ к коду в другом модуле в процессе importing. Оператор import является
наиболее распространенным способом вызова механизма импорта, но это не единственный способ. Функции, такие как
importlib.import_module() и встроенные __import__(), также могут быть использованы для вызова механизма импорта.

Оператор import сочетает в себе две операции: поиск именованного модуля, а затем привязка результатов поиска к имени в
локальной области видимости. Операция поиска оператора import определяется как вызов функции __import__() с
соответствующими аргументами. Возвращаемое значение функции __import__() используется для выполнения операции связывания
имен оператора import.

Прямой вызов __import__() выполняет только поиск модуля и, если он найден, операцию создания модуля. Хотя могут
возникнуть определенные побочные эффекты, такие как импорт родительских пакетов и обновление различных кэшей (включая
sys.modules), только оператор import выполняет операцию связывания имен.

Когда выполняется оператор import, вызывается стандартная встроенная функция __import__(). Другие механизмы вызова
системы импорта (такие как importlib.import_module()) могут обойти __import__() и использовать свои собственные решения
для реализации семантики импорта.

Когда модуль импортируется впервые, Python ищет его и, если он найден, создает объект модуля 1, инициализируя его. Если
именованный модуль не может быть найден, выдается предупреждение ModuleNotFoundError. Python реализует различные
стратегии для поиска именованного модуля при вызове механизма импорта. Эти стратегии могут быть изменены и расширены с
помощью различных крючков, описанных в следующих разделах.

```text
Изменено в версии 3.3: 
Система импорта была обновлена для полной реализации второй фазы PEP 302.
Больше нет неявного механизма импорта - полная система импорта раскрывается через sys.meta_path.
Кроме того, была реализована поддержка пакетов родного пространства имен (см. PEP 420).
```

#### importlib

Модуль importlib предоставляет богатый API для взаимодействия с системой импорта. Например, importlib.import_module()
предоставляет рекомендуемый, более простой API, чем встроенный __import__() для вызова механизма импорта. Дополнительные
подробности см. в документации по библиотеке importlib.


### Относительный и абсолютный импорт
Пример абсолютного импорта модулей из директории observer в модуль auth.py:

```python 
# импорт в файле `auth.py` 
from app.observer import schedule
```
Пример относительного импорта модулей из директории observer в auth.py:

```python
# импорт в файле `auth.py` 
from ..observer import schedule
```

Количество точек указывает на сколько (обьектов) мы поднимаемся от исходного. В данном примере первая точка поднимает на уровень handlers, а вторая точка поднимает на уровень app

Это два абсолютно разных подхода. В первом случае "опускаемся" от "корня" (папка app). Во втором случае "поднимаемся" к "корню" (папка app) от файла, в котором происходит импорт.

Абсолютный импорт может использовать синтаксис import <> или from <> import <>, но относительный импорт может использовать только вторую форму from <> import <>.

### Объект модуля, система дистрибуции пакетов в Python
Модуль - объект, который служит организационной единицей кода Python. Модули имеют пространство имен, содержащее произвольные объекты Python. Модули загружаются в Python в процессе импорта.

Все библиотеки Python (т.е. пакеты прикладных программ), которые вы загружаете при помощи менеджера пакетов (например, PIP), распределяются с помощью специальной утилиты. Такие утилиты создают дистрибутивы Python; по сути, это сжатые версированные архивы, содержащие все связанные элементы, например, исходные и ресурсные файлы.

Для дистрибуции приложения нужно:

Упаковать каталог приложения, добавив в него необходимые и рекомендуемые файлы;
Указать элементы, связанные с приложением (зависимости, ресурсы и т.п.)
Выпустить релиз  приложения.

Для управления дистрибуцией Python предлагает утилиту distutils.

Python Package Index, чаще PyPI – это централизованный онлайн-репозиторий, предназначенный для проектов-дистрибутивов Python. Пакетные менеджеры (например, pip) используют этот репозиторий для хранения, поиска и установки необходимых дистрибутивов.

